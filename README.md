# Building-a-Stock-Trading-AI-and-Documenting-the-Process

# AI-Driven Trend Following System

**強化学習・短期売買の失敗から導き出した、マクロトレンドフォロー戦略**

## 1. Overview

本プロジェクトは、株式市場における「優位性（Edge）」を工学的アプローチで探求したアルゴリズム取引システムの開発記録です。

当初は強化学習を用いた日足トレードや、LightGBMによる超短期売買（スキャルピング）を試みましたが、市場環境の非定常性や取引コストの壁に直面しました。

これらの「失敗した仮説」から得られた知見を元に、最終的に統計的優位性の見られる「中長期トレンドフォロー戦略」へと移行しました。

## 2. Features

最終的に採用したモデルの主な機能です。

* **Macro Trend Logic (マクロ戦略)**
  * **Momentum Scoring**: 「慣性の法則」を利用し、過去6ヶ月のリターン上位銘柄を動的に選定。
  * **Regime Filter**: 200日移動平均線（SMA200）とATR（ボラティリティ）を用い、下落トレンド中の銘柄や、流動性の低い銘柄を投資対象から除外。
* **Micro Trading Rules (ミクロ売買)**
  * **Dynamic Entry**: ブレイクアウト（高値更新）による順張りエントリー。
  * **Risk Management**: トレーリングストップおよび固定損切りライン（-10%）を厳格に適用。

## 3. Architecture

使用した技術スタックです。

| Category | Technology | Usage |
| :--- | :--- | :--- |
| **Language** | Python 3.9+ | メインロジックの実装 |
| **ML / AI** | LightGBM, FinBERT, Stable Baselines3 | 短期予測、センチメント分析、強化学習（検証段階で使用） |
| **Data Analysis** | Pandas, NumPy, TA-Lib | テクニカル指標計算、データ整形 |
| **Data Source** | yfinance | 市場データの取得 |

## 4. Hypothesis & Validation Process

本プロジェクトの核心は、初期仮説の棄却と改善のプロセス（Phase 1〜4）にあります。

### Phase 1: Reinforcement Learning (Daily)

* **仮説**: 「強化学習（PPO）を用いて日足データを学習させれば、最適な売買行動を獲得できる」
* **結果**: ❌ **失敗**
  * **理由**: **市場の非定常性（Non-stationarity）**。ゲームやロボット制御のような固定されたルールとは異なり、市場は参加者の心理や外部要因で常に構造が変化する。そのため、AIは「何もしない（Wait）」という局所解に陥るか、過去の特定パターンに過学習する結果となった。

### Phase 2: High-Frequency Scalping (LightGBM)

* **仮説**: 「LightGBMで5分後の値動きを予測し、高頻度で売買すれば利益が積み上がる」
* **結果**: ❌ **失敗**
  * **成行注文（Market Order）**: スプレッドと手数料コストが利益期待値を上回り、取引回数に比例して損失が拡大。
  * **指値注文（Limit Order）**: 手数料は抑えられるが、約定するのは「相場が自分に不利な方向へ急変した瞬間（落ちるナイフ）」ばかりとなり、**逆選択（Adverse Selection）**の問題を解決できなかった。

### Phase 3: NLP Sentiment Analysis

* **仮説**: 「ニュースの見出しをFinBERTで解析すれば、価格変動の初動を捉えられる」
* **結果**: ❌ **失敗** (精度 50%程度)
  * **理由**: 情報の織り込み速度。個人レベルでニュースを取得した時点で、HFT（高頻度取引）等により既に価格に反映されている。ニュースはボラティリティの要因にはなるが、方向性の予測には寄与しなかった。

### Phase 4: Trend Following (Momentum Strategy)

* **仮説**: 「市場には慣性が働き、強い銘柄は上がり続ける。ノイズの多い短期足ではなく、日足・週足レベルのトレンドに従うべき」
* **結果**: ✅ **採用**
  * **理由**: バックテストにおいて、Buy & Hold戦略と比較し、ドローダウン（資産の最大減少率）を大幅に抑制できた。特に暴落局面でキャッシュポジションへ退避する機能が有効に働いた。

## 5. Simulation Results

米国セクターETFなどを用いたバックテスト結果です。

上昇相場ではベンチマーク（S&P500等）に追随しつつ、下落相場でのダメージコントロールに成功しています。

<img width="1036" height="449" alt="スクリーンショット 2025-12-03 143752" src="https://github.com/user-attachments/assets/7c05311b-c497-4211-9a3b-b38cf99d3cf9" />

## 6. Known Issues & Future Works

現時点でのシステムの課題（技術的負債）と、今後の検証予定です。

1. **生存者バイアス (Survivorship Bias)**
   * 現在のバックテストは、現存する銘柄（yfinanceで取得可能）のみで行っているため、過去に倒産・上場廃止となった銘柄が含まれていません。これにより、パフォーマンスが実態より良く評価されている可能性があります。
2. **配当再投資の考慮**
   * 株価（Price Return）のみで計算しており、配当（Total Return）を含めた検証が完全ではありません。
3. **為替リスク**
   * 米国株運用におけるUSD/JPYの為替変動リスクはヘッジされていません。

## 7. Disclaimer

本リポジトリのコードおよび結果は研究目的で公開されています。実際の投資運用を推奨するものではありません。
